<%- include("partials/header") %>

    <h2>Contact Me</h2>

    <div class="contact-form" style="margin-top: 50px; margin-bottom: 50px;">
        <div id="statusMessage"
            style="display: none; padding: 1rem; border-radius: 4px; margin-bottom: 1rem; text-align: center;"></div>

        <% if (typeof success !=='undefined' ) { %>
            <div class="alert-success"
                style="background-color: rgba(0, 255, 0, 0.2); color: #fff; padding: 1rem; border-radius: 4px; margin-bottom: 1rem; border: 1px solid var(--accent-teal); text-align: center;">
                <%= success %>
            </div>
            <% } %>

                <% if (typeof error !=='undefined' ) { %>
                    <div class="alert-error"
                        style="background-color: rgba(255, 0, 0, 0.2); color: #fff; padding: 1rem; border-radius: 4px; margin-bottom: 1rem; border: 1px solid #ff4444; text-align: center;">
                        <%= error %>
                    </div>
                    <% } %>

                        <form id="contactForm" action="/contact" method="POST">
                            <div class="form-group">
                                <label for="name"
                                    style="color: #fff; margin-bottom: 0.5rem; display: block;">Name</label>
                                <input type="text" id="name" name="name" required class="form-control">
                            </div>

                            <div class="form-group">
                                <label for="email"
                                    style="color: #fff; margin-bottom: 0.5rem; display: block;">Email</label>
                                <input type="email" id="email" name="email" required class="form-control">
                            </div>

                            <div class="form-group">
                                <label for="message"
                                    style="color: #fff; margin-bottom: 0.5rem; display: block;">Message</label>
                                <textarea id="message" name="message" rows="5" required class="form-control"></textarea>
                            </div>

                            <button type="submit" class="btn-submit" id="submitBtn">Send Message</button>
                        </form>

                        <script>
                            document.getElementById('contactForm').addEventListener('submit', async function (e) {
                                e.preventDefault();
                                const btn = document.getElementById('submitBtn');
                                const statusDiv = document.getElementById('statusMessage');
                                const form = e.target;

                                // Initial UI state
                                btn.disabled = true;
                                btn.innerText = 'Sending...';
                                statusDiv.style.display = 'none';

                                // Remove any server-rendered alerts
                                document.querySelectorAll('.alert-success, .alert-error').forEach(el => el.remove());

                                try {
                                    const formData = new FormData(form);
                                    const data = Object.fromEntries(formData.entries());

                                    const response = await fetch('/contact', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'Accept': 'application/json'
                                        },
                                        body: JSON.stringify(data)
                                    });

                                    const result = await response.json();

                                    if (response.ok) {
                                        statusDiv.style.backgroundColor = 'rgba(0, 255, 0, 0.2)';
                                        statusDiv.style.border = '1px solid var(--accent-teal)';
                                        statusDiv.innerText = result.success || 'Message sent successfully!';
                                        statusDiv.style.display = 'block';
                                        form.reset();
                                    } else {
                                        throw new Error(result.error || 'Failed to send message.');
                                    }
                                } catch (err) {
                                    statusDiv.style.backgroundColor = 'rgba(255, 0, 0, 0.2)';
                                    statusDiv.style.border = '1px solid #ff4444';
                                    statusDiv.innerText = err.message;
                                    statusDiv.style.display = 'block';
                                } finally {
                                    btn.disabled = false;
                                    btn.innerText = 'Send Message';
                                }
                            });
                        </script>
    </div>

    <div class="glass-card" style="margin-top: 2rem;">
        <h3>Other ways to reach me:</h3>
        <ul style="list-style: none; margin-top: 1rem;">
            <li style="margin-bottom: 0.5rem;">Email: <a href="mailto:prathameshambekar15@gmail.com"
                    style="color: var(--primary-color);">prathameshambekar15@gmail.com</a></li>
            <li style="margin-bottom: 0.5rem;">Phone: +91 7756877207</li>
            <li>Location: Satara, India</li>
        </ul>
    </div>

    <%- include("partials/footer") %>